<!DOCTYPE html>
<html lang="{{_locale}}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{t 'invoice'}} - {{documentNumber}}</title>
  {{> styles}}
</head>
<body>
  <div class="document" style="position: relative;">
    {{#if isPaid}}
    <div class="paid-watermark">{{t 'paidStatus'}}</div>
    {{/if}}

    <!-- Header -->
    {{> document-header
        documentTitle=(t 'invoice')
        documentNumber=documentNumber
        documentDate=invoiceDate
        documentDateLabel=(t 'invoiceDate')
        status=status
        organization=organization
    }}

    <!-- Customer Info and Invoice Details -->
    <div class="info-grid">
      {{> address-block
          title=(t 'billTo')
          contact=customer
          address=customer.billingAddress
      }}

      <div class="document-info-box">
        <div class="info-row">
          <span class="info-label">{{t 'invoiceDate'}}</span>
          <span class="info-value">{{formatDate invoiceDate}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{t 'dueDate'}}</span>
          <span class="info-value" style="{{#if (eq status 'OVERDUE')}}color: #ff4d4f; font-weight: 700;{{/if}}">
            {{formatDate dueDate}}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">{{t 'paymentTerms'}}</span>
          <span class="info-value">{{t 'paymentTermsNet'}} {{paymentTermDays}} {{t 'date'}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{t 'paymentStatus'}}</span>
          <span class="info-value">
            <span class="payment-badge {{#if isPaid}}paid{{else}}{{#if (gt amountPaid 0)}}partial{{else}}unpaid{{/if}}{{/if}}">
              {{#if isPaid}}{{t 'paidStatus'}}{{else}}{{#if (gt amountPaid 0)}}{{t 'partial'}}{{else}}{{t 'unpaid'}}{{/if}}{{/if}}
            </span>
          </span>
        </div>
        {{#ifExists customer.taxNumber}}
        <div class="info-row">
          <span class="info-label">{{t 'customerSstNo'}}</span>
          <span class="info-value">{{customer.taxNumber}}</span>
        </div>
        {{/ifExists}}
      </div>
    </div>

    <!-- Line Items -->
    {{> line-items-table items=items showDiscount=true}}

    <!-- Totals -->
    {{> totals-section
        subtotal=subtotal
        discountAmount=discountAmount
        taxAmount=taxAmount
        total=total
        amountPaid=amountPaid
        balance=balance
    }}

    <!-- Bank Details for Payment -->
    {{#ifExists bankDetails}}
    <div class="bank-details">
      <div class="bank-details-title">{{t 'paymentDetails'}}</div>
      <div class="bank-details-content">
        <p><strong>{{t 'bankName'}}:</strong> {{bankDetails.bankName}}</p>
        <p><strong>{{t 'accountName'}}:</strong> {{bankDetails.accountName}}</p>
        <p><strong>{{t 'accountNumber'}}:</strong> {{bankDetails.accountNumber}}</p>
        <p style="margin-top: 10px; font-style: italic;">{{t 'paymentReference'}}</p>
      </div>
    </div>
    {{/ifExists}}

    <!-- e-Invoice QR Code (placeholder for MyInvois) -->
    {{#ifExists eInvoiceQrCode}}
    <div class="qr-code-section">
      <img src="{{eInvoiceQrCode}}" alt="e-Invoice QR Code" class="qr-code-image" />
      <div class="qr-code-label">{{t 'eInvoiceVerification'}}</div>
    </div>
    {{/ifExists}}

    <!-- Notes -->
    {{#ifExists notes}}
    <div class="notes-section">
      <div class="notes-title">{{t 'notes'}}</div>
      <div class="notes-content">{{notes}}</div>
    </div>
    {{/ifExists}}

    <!-- Terms and Conditions -->
    {{#ifExists termsConditions}}
    <div class="terms-section">
      <div class="terms-title">{{t 'termsAndConditions'}}</div>
      <div class="terms-content">{{termsConditions}}</div>
    </div>
    {{/ifExists}}

    <!-- Footer -->
    {{> document-footer organization=organization}}
  </div>
</body>
</html>
