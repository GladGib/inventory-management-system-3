<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice - {{documentNumber}}</title>
  {{> styles}}
</head>
<body>
  <div class="document" style="position: relative;">
    {{#if isPaid}}
    <div class="paid-watermark">PAID</div>
    {{/if}}

    <!-- Header -->
    {{> document-header
        documentTitle="Invoice"
        documentNumber=documentNumber
        documentDate=invoiceDate
        documentDateLabel="Invoice Date"
        status=status
        organization=organization
    }}

    <!-- Customer Info and Invoice Details -->
    <div class="info-grid">
      {{> address-block
          title="Bill To"
          contact=customer
          address=customer.billingAddress
      }}

      <div class="document-info-box">
        <div class="info-row">
          <span class="info-label">Invoice Date</span>
          <span class="info-value">{{formatDate invoiceDate}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Due Date</span>
          <span class="info-value" style="{{#if (eq status 'OVERDUE')}}color: #ff4d4f; font-weight: 700;{{/if}}">
            {{formatDate dueDate}}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">Payment Terms</span>
          <span class="info-value">Net {{paymentTermDays}} days</span>
        </div>
        <div class="info-row">
          <span class="info-label">Payment Status</span>
          <span class="info-value">
            <span class="payment-badge {{#if isPaid}}paid{{else}}{{#if (gt amountPaid 0)}}partial{{else}}unpaid{{/if}}{{/if}}">
              {{#if isPaid}}PAID{{else}}{{#if (gt amountPaid 0)}}PARTIAL{{else}}UNPAID{{/if}}{{/if}}
            </span>
          </span>
        </div>
        {{#ifExists customer.taxNumber}}
        <div class="info-row">
          <span class="info-label">Customer SST No</span>
          <span class="info-value">{{customer.taxNumber}}</span>
        </div>
        {{/ifExists}}
      </div>
    </div>

    <!-- Line Items -->
    {{> line-items-table items=items showDiscount=true}}

    <!-- Totals -->
    {{> totals-section
        subtotal=subtotal
        discountAmount=discountAmount
        taxAmount=taxAmount
        total=total
        amountPaid=amountPaid
        balance=balance
    }}

    <!-- Bank Details for Payment -->
    {{#ifExists bankDetails}}
    <div class="bank-details">
      <div class="bank-details-title">Payment Details</div>
      <div class="bank-details-content">
        <p><strong>Bank Name:</strong> {{bankDetails.bankName}}</p>
        <p><strong>Account Name:</strong> {{bankDetails.accountName}}</p>
        <p><strong>Account Number:</strong> {{bankDetails.accountNumber}}</p>
        <p style="margin-top: 10px; font-style: italic;">Please use invoice number as payment reference.</p>
      </div>
    </div>
    {{/ifExists}}

    <!-- e-Invoice QR Code (placeholder for MyInvois) -->
    {{#ifExists eInvoiceQrCode}}
    <div class="qr-code-section">
      <img src="{{eInvoiceQrCode}}" alt="e-Invoice QR Code" class="qr-code-image" />
      <div class="qr-code-label">Scan for e-Invoice verification</div>
    </div>
    {{/ifExists}}

    <!-- Notes -->
    {{#ifExists notes}}
    <div class="notes-section">
      <div class="notes-title">Notes</div>
      <div class="notes-content">{{notes}}</div>
    </div>
    {{/ifExists}}

    <!-- Terms and Conditions -->
    {{#ifExists termsConditions}}
    <div class="terms-section">
      <div class="terms-title">Terms & Conditions</div>
      <div class="terms-content">{{termsConditions}}</div>
    </div>
    {{/ifExists}}

    <!-- Footer -->
    {{> document-footer organization=organization}}
  </div>
</body>
</html>
